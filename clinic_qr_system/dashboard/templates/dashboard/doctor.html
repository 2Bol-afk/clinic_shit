{% extends 'base.html' %}
{% block content %}
<h4 class="d-flex align-items-center mb-3"><i class="bi bi-stethoscope text-success me-2"></i>Doctor Dashboard ({{ today }})</h4>
<div class="row g-3">
  <div class="col-md-7">
    <div class="card shadow-sm">
      <div class="card-header"><i class="bi bi-journal-medical me-2"></i>Latest Consultations Today</div>
      <div class="card-body">
        <table class="table table-sm">
          <thead><tr><th>Time</th><th>Patient</th><th>Symptoms</th><th>Diagnosis</th><th>Prescription</th></tr></thead>
          <tbody>
            {% for v in visits %}
              <tr>
                <td>{{ v.timestamp|date:'H:i' }}</td>
                <td><a href="/patients/{{ v.patient.id }}/">{{ v.patient.full_name }}</a></td>
                <td>{{ v.symptoms }}</td>
                <td>{{ v.diagnosis }}</td>
                <td>{{ v.prescription_notes }}</td>
              </tr>
            {% empty %}
              <tr><td colspan="5">No consultations yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="col-md-5">
    <div class="card shadow-sm mb-3">
      <div class="card-header"><i class="bi bi-person-walking me-2"></i>Waiting (Reception)</div>
      <div class="card-body">
        {% if unfinished %}
          <div class="alert alert-warning">Finish your current consultation before claiming another patient.</div>
        {% endif %}
        <ul class="list-group">
          {% for r in waiting %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>
                <a href="/patients/{{ r.patient.id }}/"><i class="bi bi-person-fill me-1"></i>{{ r.patient.full_name }}</a>
                <small class="text-muted">(Queue #{{ r.queue_number|default:'-' }}, {{ r.department|default:'General Medicine' }})</small>
              </span>
              <form method="post" action="/dashboard/doctors/claim/">
                {% csrf_token %}
                <input type="hidden" name="reception_visit_id" value="{{ r.id }}">
                <button class="btn btn-success btn-sm" type="submit"><i class="bi bi-hand-index-thumb me-1"></i>Claim</button>
              </form>
            </li>
          {% empty %}
            <li class="list-group-item">No waiting patients.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
    <div class="card shadow-sm">
      <div class="card-header"><i class="bi bi-clock-history me-2"></i>Your Recent Actions</div>
      <div class="card-body">
        <ul class="list-group">
          {% for v in timeline %}
            <li class="list-group-item">
              <i class="bi bi-person-badge me-1"></i>{{ v.timestamp|date:'H:i' }} â€” {{ v.patient.full_name }}
              {% if v.diagnosis %}<div class="small">Dx: {{ v.diagnosis }}</div>{% endif %}
              {% if v.prescription_notes %}<div class="small">Rx: {{ v.prescription_notes }}</div>{% endif %}
            </li>
          {% empty %}
            <li class="list-group-item">No recent actions.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}
